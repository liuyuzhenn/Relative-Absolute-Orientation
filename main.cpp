#include <iostream>
#include <vector>
#include "include/Eigen/Dense"
#include "orient.h"
using namespace std;
using namespace Eigen;

int main()
{

    // unknown points that need to compute
    vector<vector<double>> conjugates_draw = {
{ 11649.0 , 9584.0 , 6673.0 , 9550.0 , 5334.628 , 3002.212 , 3.773 },
{ 13247.0 , 9076.0 , 8256.0 , 9042.0 , 5385.002 , 3159.919 , 10.738 },
{ 13117.0 , 9484.0 , 8136.0 , 9450.0 , 5344.528 , 3148.386 , 6.684 },
{ 11084.0 , 10546.0 , 6106.0 , 10511.0 , 5238.35 , 2945.912 , 4.808 },
{ 12772.0 , 10730.0 , 7796.0 , 10695.0 , 5220.662 , 3114.938 , 3.554 },
{ 12091.0 , 7812.0 , 7096.0 , 7776.0 , 5510.088 , 3044.056 , 12.447 },
{ 13807.0 , 5625.0 , 8805.0 , 5589.0 , 5727.223 , 3213.093 , 16.364 },
{ 10351.0 , 9728.0 , 5376.0 , 9692.0 , 5319.902 , 2872.601 , 3.709 },
{ 9708.0 , 8875.0 , 4732.0 , 8839.0 , 5404.928 , 2808.164 , 3.82 },
{ 11422.0 , 8030.0 , 6445.0 , 7997.0 , 5489.676 , 2978.893 , 3.391 },
{ 10008.0 , 9945.0 , 4985.0 , 9909.0 , 5295.495 , 2836.21 , 25.043 },
{ 9837.0 , 10601.0 , 4832.0 , 10568.0 , 5231.116 , 2820.116 , 18.278 },
{ 8780.0 , 7179.0 , 3805.0 , 7144.0 , 5573.891 , 2714.724 , 3.639 },
{ 10024.0 , 8234.0 , 5049.0 , 8200.0 , 5469.028 , 2839.448 , 3.753 },
{ 9257.0 , 10011.0 , 4281.0 , 9975.0 , 5291.416 , 2763.586 , 3.788 },
{ 8339.0 , 9345.0 , 3362.0 , 9309.0 , 5357.44 , 2671.406 , 3.798 },
{ 9786.0 , 8865.0 , 4810.0 , 8830.0 , 5406.108 , 2815.897 , 3.776 },
{ 9482.0 , 9523.0 , 4506.0 , 9487.0 , 5340.068 , 2785.766 , 3.825 },
{ 8462.0 , 7814.0 , 3487.0 , 7778.0 , 5510.427 , 2682.898 , 3.614 },
{ 8668.0 , 7476.0 , 3691.0 , 7441.0 , 5544.125 , 2703.629 , 4.212 },
{ 7612.0 , 9302.0 , 2577.0 , 9268.0 , 5357.362 , 2598.498 , 31.497 },
{ 5958.0 , 8746.0 , 983.0 , 8711.0 , 5416.31 , 2433.337 , 3.761 },
{ 8650.0 , 7506.0 , 3673.0 , 7472.0 , 5541.118 , 2701.933 , 4.212 },
{ 8626.0 , 8918.0 , 3604.0 , 8883.0 , 5396.608 , 2698.796 , 24.962 },
{ 8111.0 , 5687.0 , 3135.0 , 5653.0 , 5722.924 , 2647.412 , 3.623 },
{ 8211.0 , 5114.0 , 3235.0 , 5079.0 , 5780.286 , 2657.184 , 3.6 },
{ 7013.0 , 5794.0 , 1964.0 , 5759.0 , 5701.551 , 2538.295 , 38.43 },
{ 5844.0 , 8497.0 , 869.0 , 8461.0 , 5441.679 , 2421.988 , 3.58 },
    };

    // conjugate points for relative orientation
    vector<vector<double>> conjugate_points_mine = {
{ 5141.0 , 815.0 , 141.0 , 781.0 },
{ 6626.0 , 3320.0 , 1536.0 , 3286.0 },
{ 8127.0 , 2998.0 , 3134.0 , 2965.0 },
{ 8160.0 , 4200.0 , 3141.0 , 4165.0 },
{ 8789.0 , 520.0 , 3785.0 , 486.0 },
{ 9662.0 , 1325.0 , 4659.0 , 1295.0 },
{ 10109.0 , 3275.0 , 4912.0 , 3239.0 },
{ 10823.0 , 2001.0 , 5831.0 , 1966.0 },
{ 12580.0 , 1026.0 , 7575.0 , 991.0 },
{ 13292.0 , 3677.0 , 8148.0 , 3640.0 },
{ 6180.0 , 5617.0 , 1180.0 , 5582.0 },
{ 6822.0 , 8434.0 , 1822.0 , 8396.0 },
{ 7715.0 , 7344.0 , 2697.0 , 7309.0 },
{ 10338.0 , 7385.0 , 5343.0 , 7351.0 },
{ 10727.0 , 5958.0 , 5685.0 , 5925.0 },
{ 10760.0 , 7951.0 , 5738.0 , 7917.0 },
{ 10464.0 , 9502.0 , 5384.0 , 9467.0 },
{ 13404.0 , 5420.0 , 8391.0 , 5385.0 },
{ 12303.0 , 7093.0 , 7304.0 , 7058.0 },
{ 13367.0 , 9204.0 , 8368.0 , 9170.0 },
{ 5616.0 , 10082.0 , 618.0 , 10046.0 },
{ 5666.0 , 14426.0 , 670.0 , 14391.0 },
{ 7167.0 , 12106.0 , 2151.0 , 12071.0 },
{ 7299.0 , 13631.0 , 2318.0 , 13597.0 },
{ 9441.0 , 12597.0 , 4302.0 , 12561.0 },
{ 8940.0 , 14261.0 , 3922.0 , 14228.0 },
{ 10476.0 , 10574.0 , 5480.0 , 10539.0 },
{ 11275.0 , 12660.0 , 6218.0 , 12625.0 },
{ 12977.0 , 10428.0 , 8001.0 , 10394.0 },
{ 13112.0 , 14299.0 , 8099.0 , 14263.0 },
{ 5690.0 , 15942.0 , 664.0 , 15907.0 },
{ 5160.0 , 18503.0 , 158.0 , 18469.0 },
{ 6311.0 , 19744.0 , 1285.0 , 19709.0 },
{ 8498.0 , 16800.0 , 3521.0 , 16766.0 },
{ 9058.0 , 19137.0 , 3969.0 , 19101.0 },
{ 10444.0 , 15768.0 , 5435.0 , 15732.0 },
{ 11704.0 , 19765.0 , 6552.0 , 19730.0 },
{ 12236.0 , 15242.0 , 7221.0 , 15206.0 },
{ 13989.0 , 16382.0 , 8974.0 , 16347.0 },
{ 13387.0 , 18908.0 , 8374.0 , 18873.0 },
{ 6507.0 , 21346.0 , 1416.0 , 21313.0 },
{ 5674.0 , 23618.0 , 665.0 , 23583.0 },
{ 8592.0 , 21213.0 , 3410.0 , 21179.0 },
{ 9342.0 , 22712.0 , 4537.0 , 22678.0 },
{ 7896.0 , 25070.0 , 2919.0 , 25039.0 },
{ 11946.0 , 21253.0 , 6949.0 , 21218.0 },
{ 12534.0 , 22386.0 , 7551.0 , 22352.0 },
{ 11432.0 , 25563.0 , 6459.0 , 25530.0 },
{ 13897.0 , 20523.0 , 8920.0 , 20488.0 },
{ 12939.0 , 24086.0 , 7931.0 , 24053.0 },
    };

    // ground control points
    vector<vector<double>> GCPs_mine = {
{ 11649.0 , 9584.0 , 6673.0 , 9550.0 , 5334.628 , 3002.212 , 3.773 },
{ 13247.0 , 9076.0 , 8256.0 , 9042.0 , 5385.002 , 3159.919 , 10.738 },
{ 13117.0 , 9484.0 , 8136.0 , 9450.0 , 5344.528 , 3148.386 , 6.684 },
{ 11084.0 , 10546.0 , 6106.0 , 10511.0 , 5238.35 , 2945.912 , 4.808 },
{ 12772.0 , 10730.0 , 7796.0 , 10695.0 , 5220.662 , 3114.938 , 3.554 },
{ 12091.0 , 7812.0 , 7096.0 , 7776.0 , 5510.088 , 3044.056 , 12.447 },
{ 13807.0 , 5625.0 , 8805.0 , 5589.0 , 5727.223 , 3213.093 , 16.364 },
{ 10351.0 , 9728.0 , 5376.0 , 9692.0 , 5319.902 , 2872.601 , 3.709 },
{ 9708.0 , 8875.0 , 4732.0 , 8839.0 , 5404.928 , 2808.164 , 3.82 },
{ 11422.0 , 8030.0 , 6445.0 , 7997.0 , 5489.676 , 2978.893 , 3.391 },
{ 10008.0 , 9945.0 , 4985.0 , 9909.0 , 5295.495 , 2836.21 , 25.043 },
{ 9837.0 , 10601.0 , 4832.0 , 10568.0 , 5231.116 , 2820.116 , 18.278 },
{ 8780.0 , 7179.0 , 3805.0 , 7144.0 , 5573.891 , 2714.724 , 3.639 },
{ 10024.0 , 8234.0 , 5049.0 , 8200.0 , 5469.028 , 2839.448 , 3.753 },
{ 9257.0 , 10011.0 , 4281.0 , 9975.0 , 5291.416 , 2763.586 , 3.788 },
{ 8339.0 , 9345.0 , 3362.0 , 9309.0 , 5357.44 , 2671.406 , 3.798 },
{ 9786.0 , 8865.0 , 4810.0 , 8830.0 , 5406.108 , 2815.897 , 3.776 },
{ 9482.0 , 9523.0 , 4506.0 , 9487.0 , 5340.068 , 2785.766 , 3.825 },
{ 8462.0 , 7814.0 , 3487.0 , 7778.0 , 5510.427 , 2682.898 , 3.614 },
{ 8668.0 , 7476.0 , 3691.0 , 7441.0 , 5544.125 , 2703.629 , 4.212 },
{ 7612.0 , 9302.0 , 2577.0 , 9268.0 , 5357.362 , 2598.498 , 31.497 },
{ 5958.0 , 8746.0 , 983.0 , 8711.0 , 5416.31 , 2433.337 , 3.761 },
{ 8650.0 , 7506.0 , 3673.0 , 7472.0 , 5541.118 , 2701.933 , 4.212 },
{ 8626.0 , 8918.0 , 3604.0 , 8883.0 , 5396.608 , 2698.796 , 24.962 },
{ 8111.0 , 5687.0 , 3135.0 , 5653.0 , 5722.924 , 2647.412 , 3.623 },
{ 8211.0 , 5114.0 , 3235.0 , 5079.0 , 5780.286 , 2657.184 , 3.6 },
{ 7013.0 , 5794.0 , 1964.0 , 5759.0 , 5701.551 , 2538.295 , 38.43 },
{ 5844.0 , 8497.0 , 869.0 , 8461.0 , 5441.679 , 2421.988 , 3.58 },
    };




    RAOrient o = RAOrient(conjugate_points_mine, GCPs_mine);
    o.solve();

    // compute GCPs to check the error
    vector<Vector3d> res = o.compute(conjugates_draw);

    // display GCPs' errors
    for (size_t i = 0; i < conjugates_draw.size(); i++) {
        cout << i + 1 << "\n";

        cout << "\nEstimated: \n";
        cout << res[i][1] << ", " << res[i][0] << ", " << res[i][2] << endl;

        cout << "\nTrue: \n";
        cout << conjugates_draw[i][4] << ", " 
            << conjugates_draw[i][5] << ", " << conjugates_draw[i][6] << endl;


        // error
        cout << "\nerror x, y, z: \n";
        double dx = conjugates_draw[i][4] - res[i][1];
        double dy = conjugates_draw[i][5] - res[i][0];
        double dz = conjugates_draw[i][6] - res[i][2];
        cout << dx << ", " << dy
            << ", " << dz << endl;

        
        //cout << sqrt(dx * dx + dy * dy + dz * dz) << endl;
        cout << "--------------------" << endl;
    }
    
    
    return 0;
}